<!doctype html>
<html>
<head>
<link rel="import" href="imports/onFrontiersReady.html">
<script src="../bower_components/three.js/build/three.min.js"></script>
<script src="../bower_components/three.js/examples/js/controls/TrackballControls.js"></script>
</head>
<body>
<script defer async>
onFrontiersReady(function(){
  'use strict';
  console.log('frontiers loaded');
  var
    renderer = new Frontiers.Renderers.THREE(
      THREE.WebGLRenderer,
      1280,
      720
    )
  ;
  renderer.Controls = THREE.TrackballControls;
  renderer.Render();
  window.renderer = renderer;
  document.body.appendChild(renderer.RenderSurface);
  Frontiers.Data.GameData.IO.InitializeSystemPaths(
    (function(){
      var
        path = location.pathname.split('/')
      ;
      path.pop();
      path.pop();
      path.push('Data');
      path.unshift(location.hostname);
      return location.protocol + '//' + path.join('/');
    })()
  ).then(function(){
    Frontiers.Data.GameData.IO.LoadWorld('FRONTIERS').then(function(world){
      Promise.all(world.DefaultRevealedLocations.map(function(revealedLocation){
        return renderer.AddObject(revealedLocation);
      })).then(function(revealedLocations){
        console.log('should be done now');
        renderer.Play();
        renderer.Camera.position.x = 15000;
        renderer.Camera.position.z = 15000;
      }, function(failure){
        console.error(failure);
      });
    });
  });
});
</script>
</body>
</html>
